<!DOCTYPE html>
<html>
  <head>
    <!--Firebase-->
    <script src="https://www.gstatic.com/firebasejs/7.8.1/firebase-app.js"></script>

    <!--Import Google Icon Font-->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <!-- Compiled and minified CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
    />
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <!--CSS Style Sheet-->
    <link rel="stylesheet" type="text/css" href="Assets/style.css" />

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>

  <!--Main Body of App-->
  <body id="background" class= "col s12 m6" style="background-image:url(Assets/Images/pexels-photo-1071878.jpeg)">
    <div class="navbar-fixed">
      <nav class="teal">
        <div id="nav-mobile">
          <div class="nav-wrapper">
            <a href="" class="brand-logo">The Saavy Traveler</a>
             <ul id="nav-mobile" class="right hide-on-med-and-down">
              <li>
                <a href="#home">Home</a>
              </li>
              <li>
                <a href="#reviews">Reviews</a>
              </li>
              <li>
                <a href="#videoGallery">Video Gallery</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </div>
    <ul class="sidenav" id="mobile-demo">
      <li>
        <a href="#home">Home</a>
      </li>
      <li>
        <a href="#reviews">Reviews</a>
      </li>
      <li>
        <a href="#videoGallery">Video Gallery</a>
      </li>
    </ul>
      <!-- Section: Slider -->
  
    <section class="slider">
    <ul class="slides">
      <li>
        <img src="Assets/Images/pexels-photo-572738.jpeg" alt="coffee">
        <div class="caption center-align">
          <h2>A New Worry Free Forward Towards Your Destination</h2>  
        </div>
      </li>
      <li>
        <img src="Assets/Images/pexels-photo-704571.jpeg" alt="image2">
        <div class="caption left-align">
          <h2>Find The Best Reviews</h2>
        </div>
      </li>
      <li>
        <img src="Assets/Images/food-dessert-sweet-color.jpg" alt="desert">
        <div class="caption right-align">
          <h2>Save Results on a Custom Made Itinerary</h2>
        </div>
      </li>
    </ul>
  </section>
   
    
  <div class="container">
      
      <h3 class="dest">Destination City:</h>

      <div class="nav-wrapper">
        <div class="input-field col s12 m6">
          <input id="city-input" type="text" class="validate" />
        </div>
      </div>
      <button
        id="submitBtn"
        class="btn-small blue-grey accent-2 waves-effect waves-dark card_travel"
        type="submit"
        name="action">Search<i class="material-icons right">restaurant</i>
      </button>
    </div>
    <section id="img" class="center-align"><img src="Assets/Images/pexels-photo-2130134.jpeg" alt="food" style="width:30em;;height:20em;">
    </section>
    
    <section class="center-align">
      <div class="row">
      <div class="rev">Top Reviews</div>
      </div>
   </section>
    
   <section class="center-align">
    <div class="col s12 m6" id="yelpArea"></div>
    <div id="youTubeArea"></div>
    <h2 id="videoHeader" class="col s12 m6"> The City Life</h2>
    <iframe src=""></iframe>
    <p class="description">Video Description</p>
    <div id="itineraryArea"></div>
  </section>
  
  <!--itinerary table container-->
  <div id="itineraryArea" class="container">
    <div class="row">
      <div class="col-s12-m6">
        <div class="card text-white border-danger mb-4">
          <h5 class="card-header center-align lime accent-2">Itinerary</h5>
          <div class="card-body lime lighten-5">
            <table class="responsive-table highlight table-hover" id='itinerary-table'>
              <thead class="thead-light">
                <tr>
                  <th scope="col">Restaurant</th>
                  <th scope="col">Phone Number</th>
                  <th scope="col">Address</th>
                  <th scope="col">City</th>
                  <th scope="col">State</th>
                  <th scope="col">Zip Code</th>
                  <th scope="col">Delete</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>


    <script src="https://code.jquery.com/jquery.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>



      $(document).ready(function () {

        $('iframe').hide();

        //function that adds itinerary row to the table
        function renderItineraries(itineraries) {
          $('#itinerary-table tbody').empty();

          for (var i = 0; i < itineraries.length; i++) {
            var newRow = $("<tr>").append(
              $("<td>").text(itineraries[i].name),
              $("<td>").text(itineraries[i].phone),
              $("<td>").text(itineraries[i].address),
              $("<td>").text(itineraries[i].city),
              $("<td>").text(itineraries[i].state),
              $("<td>").text(itineraries[i].zipCode));

            var deleteButton = $("<button>");
            deleteButton.attr("data-itinerary", i)
              .attr("type", "delete")
              .addClass("deleteButton")
              .text("Delete");

            newRow = newRow.append(deleteButton);
            $("#itinerary-table").append(newRow);
          }
        }
        //creates a variable that stores and parses information from localStorage
        var itineraries = JSON.parse(localStorage.getItem("itineraries"));

        //if statement that says if there is nothing in the variable itineraries, 
        //then the the itineraries array will be empty
        if (!itineraries) {
          itineraries = [];
        }
        //calls renderItineraries function
        renderItineraries(itineraries);

        $("#submitBtn").on("click", function (event) {
          event.preventDefault();

          $("#yelpArea").html("");

          cityName = $("#city-input")
            .val()
            .trim();

          $('iframe').show();

          $.ajax({
            url:
              "https://cors-anywhere.herokuapp.com/https://api.yelp.com/v3/businesses/search",
            method: "GET",
            error: function (error) {
              console.log("error", error);
            },
            headers: {
              Authorization:
                "Bearer 777OVHyUQXu4MD9WPwXQ3dub9jGslCwGt185TfYEQF6JoBa7tr7kjVe7OvbcNzwp2mY8k3JkODi2curLYOzJsG5dKxmQD8SzDYABjKEzUGC8i3Bk4vXHaU6P5G5DXnYx"
            },
            dataType: "json",
            data: { term: "restaurant", location: cityName, limit: "5" }



          }).then(function (response) {

            console.log(response);


            var totalresults = response.total;

            if (totalresults > 0) {


              $.each(response.businesses, function (i, item) {


                //I made a bunch of changes here with the attributes
                var restaurantDiv = $("<div>")
                  .addClass("restaurant")
                  .attr("name-val", item.name)
                  .attr("phone-val", item.display_phone)
                  .attr("address-val", item.location.address1)
                  .attr("city-val", item.location.city)
                  .attr("state-val", item.location.state)
                  .attr("zip-val", item.location.zip_code);
                var image = $("<img>");
                image.attr("src", item.image_url)
                  .addClass("image")
                  .attr("style", "width:200px; height:150px; margin-top:50px");
                var name = $("<p>")
                  .addClass("name")
                  .html("We found " + item.name.bold());
                var address = $("<p>")
                  .addClass("address")
                  .attr("style", "margin-top:-15px")
                  .html(item.location.address1 + " " + item.location.city + " " + item.location.state + " " + item.location.zip_code);
                var phone = $("<p>")
                  .addClass("phone")
                  .attr("style", "margin-top:-15px")
                  .html("The phone number for this business is: " + item.display_phone);
                var ratingWithReviewCount = $("<p>")
                  .addClass("ratingWithReviewCount")
                  .attr("style", "margin-top:-15px")
                  .html("This business has a rating of " + item.rating + " with " + item.review_county + " reviews.");

                restaurantDiv.append(image);
                restaurantDiv.append(name);
                restaurantDiv.append(address);
                restaurantDiv.append(phone);
                restaurantDiv.append(ratingWithReviewCount);
                $("#yelpArea").append(restaurantDiv);
                //copy-paste down to here from the restaurantDiv, just in case

              });
            } else {

              $("#yelpArea").append("<h5>We discovered no results!</h5>");
            }
          });

          $.ajax({
            type: 'GET',
            url: 'https://www.googleapis.com/youtube/v3/search',
            data: {
              key: 'AIzaSyA5QGk0Aszi91ubsph31l_NmGzzct6vL9s',
              q: cityName,
              part: 'snippet',
              maxResults: 1,
              type: 'video',
              chart: 'mostPopular',
              videoEmbeddable: true,
            },
            error: function (response) {
              $("youTubeArea").append("<h5>Request Failed</h5>");
            }
          }).then(function (response) {
            console.log(response);

            $('iframe').attr('src', 'https://www.youtube.com/embed/' + response.items[0].id.videoId);
            $("#youTubeArea").append("<h3>" + response.items[0].snippet.title + "</h3>")
              .append("<p>" + response.items[0].snippet.description + "</p>");

          });
        });
        //created function to add to itinerary on table and localStorage
        function addToItinerary() {

          var name = $(this).attr("name-val");
          var phone = $(this).attr("phone-val");
          var address = $(this).attr("address-val");
          var city = $(this).attr("city-val");
          var state = $(this).attr("state-val");
          var zipCode = $(this).attr("zip-val");

          var itinerary = {
            name: name,
            phone: phone,
            address: address,
            city: city,
            state: state,
            zipCode: zipCode
          }

          itineraries.push(itinerary);

          renderItineraries(itineraries);

          localStorage.setItem("itineraries", JSON.stringify(itineraries));

        };

        //clicking on the restaurant div adds to the itinerary table and storage
        $(document).on("click", ".restaurant", addToItinerary);

        //clicking on the delete button in a row of the table deletes
        //row on table and element in local storage
        $(document).on("click", ".deleteButton", function () {
          event.preventDefault();

          var toDoNumber = $(this).attr("data-itinerary");

          itineraries.splice(toDoNumber, 1);

          renderItineraries(itineraries);
          localStorage.setItem("itineraries", JSON.stringify(itineraries));
        })

      });

    </script>
</body>


  <div class="footer-copyright text center-align">
    <div class="container">
    © 2020 Copyright
    </div>
  </div>
</footer>    
</html>
    